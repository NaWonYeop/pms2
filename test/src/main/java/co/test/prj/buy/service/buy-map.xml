<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.test.prj.buy.service.BuyMapper">
	
	<select id="buySelectList">
		SELECT * FROM BUY
	</select>

	<insert id="buyInsert" parameterType="co.test.prj.buy.service.BuyVO">
			INSERT INTO BUY(BUY_ID, USER_ID, BUY_WAY, REWARD_ID, PRJ_ID, BUY_COUNT, BUY_WON, BUY_WEI, BUY_MUID)
			VALUES(#{buy_id},#{user_id},#{buy_way},#{reward_id}, #{prj_id}, #{buy_count}, #{buy_won}, #{buy_wei}, #{buy_muid})
	</insert>

	<select id="buyMaxId" resultType="int">
		SELECT NVL(MAX(BUY_ID) + 1, 1) AS ID FROM BUY
	</select>

	<select id="buyMaxCoinCount" resultType="int">
		SELECT NVL(COUNT(BUY_ID)+1,1) AS MAXCOUNT
		FROM BUY 
		WHERE USER_ID = #{user_id}
		AND BUY_WAY = 'coin'
	</select>
	
	<update id="buyRFund" parameterType="co.test.prj.buy.service.BuyVO">
		UPDATE BUY
		<set>
			BUY_STT = #{buy_stt},
			BUY_RFND_DATE = sysdate,
			<if test="buy_rfnd_won != null"> BUY_RFND_WON = #{buy_rfnd_won},</if>
			<if test="buy_rfnd_wei != null"> BUY_RFND_WEI = #{buy_rfnd_wei},</if>
		</set>
		WHERE BUY_ID = #{buy_id}
	</update>
	
</mapper>