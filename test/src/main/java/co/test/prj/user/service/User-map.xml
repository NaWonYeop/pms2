<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.test.prj.user.service.UserMapper">

	<select id="userSelectList"
		resultType="co.test.prj.user.service.UserVO">
		SELECT * FROM "user"
	</select>
	<!-- 로그인 -->
	<select id="userSelect"
		resultType="co.test.prj.user.service.UserVO"
		parameterType="co.test.prj.user.service.UserVO">
		SELECT * FROM "user" WHERE user_email = #{user_email}
		<if test="user_pwd != null">
			AND user_pwd = #{user_pwd}
		</if>
	</select>

	<select id="searchPwd"
		resultType="co.test.prj.user.service.UserVO"
		parameterType="co.test.prj.user.service.UserVO">
		select * from "user" where user_name = #{user_name} and
		user_email =
		#{user_email}
	</select>

	<!-- 비번찾기 -->
	<update id="updatePwd"
		parameterType="co.test.prj.user.service.UserVO">
		update "user" set user_pwd = #{user_pwd} where
		user_email = #{user_email} and user_name = #{user_name}
	</update>
	<!--회원가입 -->
	<insert id="userInsert"
		parameterType="co.test.prj.user.service.UserVO">
		<selectKey keyProperty="user_id" resultType="int"
			order="BEFORE">
			SELECT MAX(user_id) + 1 FROM "user"
		</selectKey>
		INSERT INTO "user"(USER_ID,USER_EMAIL, USER_PWD,
		USER_NAME, USER_TEL,
		user_ath, user_type)
		VALUES(#{user_id},#{user_email},#{user_pwd},#{user_name},#{user_tel},#{user_ath},#{user_type})
	</insert>
	<!-- 중복체크 -->
	<select id="isIdCheck" parameterType="String"
		resultType="boolean">
		SELECT CASE WHEN COUNT(*) = 1 THEN 0 ELSE 1 END AS ID
		FROM
		"user"
		WHERE USER_EMAIL = #{email}
	</select>

	<!-- 아이디찾기 -->
	<select id="userSearch"
		parameterType="co.test.prj.user.service.UserVO"
		resultType="co.test.prj.user.service.UserVO">
		SELECT * FROM "user" WHERE USER_NAME = #{user_name} AND
		USER_TEL =
		#{user_tel}
	</select>
	<!-- 회원정보 수정 -->
	<update id="userUpdate"
		parameterType="co.test.prj.user.service.UserVO">
		UPDATE "user"
		<set>
			<if test="user_pwd != null"> user_pwd = #{user_pwd}, </if>
			<if test="user_name != null"> user_name = #{user_name}, </if>
			<if test="user_tel != null"> user_tel = #{user_tel}, </if>
			<if test="user_ath != null"> user_ath = #{user_ath}, </if>
			<if test="user_crr != null"> user_crr = #{user_crr}, </if>
			<if test="user_age != null"> user_age = #{user_age}, </if>
			<if test="user_job_ttl != null"> user_job_ttl = #{user_job_ttl}, </if>
			<if test="user_job_cnt != null"> user_job_cnt = #{user_job_cnt}, </if>
			<if test="user_type != null"> user_type = #{user_type}, </if>
		</set>
		WHERE USER_ID =#{user_id}
	</update>
	<!-- 비밀번호확인 -->
	<select id="checkPwd"
		parameterType="co.test.prj.user.service.UserVO"
		resultType="co.test.prj.user.service.UserVO">
		select * from "user" where user_pwd = #{user_pwd}
	</select>
	<!-- 회원탈퇴 -->
	<delete id="userDelete"
		parameterType="co.test.prj.user.service.UserVO">
		DELETE FROM "user" WHERE user_id = #{user_id}
	</delete>

	<select id="jobSelect"
		resultType="co.test.prj.user.service.UserVO">
		SELECT * FROM "user" WHERE USER_ID = ${user_id}
		<!-- select u.user_name, u.user_crr, u.user_job_ttl, u.user_job_cnt, (select 
			avg(s.str_avg) from star s where u.user_id = s.user_id group by user_id) 
			from "user" u; -->
	</select>

	<select id="MyProject"
		resultType="co.test.prj.project.service.ProjectVO"
		parameterType="co.test.prj.team.service.TeamVO">
		SELECT DISTINCT PRJ_ID,PRJ_NAME,PRJ_ED
		FROM PROJECT
		WHERE PRJ_ID IN (SELECT DISTINCT PRJ_ID
		FROM TEAM
		WHERE USER_ID=#{user_id} OR MASTER_ID=#{master_id}) OR MASTER_ID = #{master_id}

	</select>

</mapper>

	
	